{
    "contents" : "#' Physical Activity Summary-Summations\n#'\n#' Summarize activity measures\n#' @param final.dat cleaned final data that is between record getup time and sleep time\n#' @return hours.worn.total Total worn hours\n#' @return sed.hour  Total sedantary hours\n#' @return stand.hour Total stand hours\n#' @return step.hour Total step hours\n#' @return num.changes.from.sed.to.non.sed Numbers of changing from sedantary to non sadantary status\n#' @return step.count.total Total step count\n#' @return gini.index   Gini index of sedentary\n#' @return num.hour.over.3.METs Number of hours that Metabolic Equivalent of Task (MET) is over 3\n#' @return MET.hours  Total METs\n#' @return table A table that shows all above results\n#' @details All numbers are calculated in the given time period (day, hour, etc.). Total sedentary/standing/stepping hours are obtained from the summation of the duration times for sedentary/standing/stepping activities in the given time period. To calculate gini index, all of the recorded sedentary durations are listed and the \\emph{gini} function in the R package \\pkg{reldist} is used.\n\n#' @examples  data(sampledata);PA_summary(sampledata)\n#' @export\nPA_summary=function (final.dat) {\n  library(reldist)\n\n  dat=final.dat\n  if(is.numeric(dat$Time)==F) ####if  is.numeric(dat$Time)==F, we need further modification of time in next step\n  {\n    ee<-as.character(dat$Time)\n    max.length<-max(nchar(ee))\n    ee[nchar(ee)!=max.length]<-\"#1899-12-30 00:00:00#\"\n    #### use character type, may not be good\n    ee.new<- (as.numeric( as.POSIXlt( substr(ee, 2, max.length-1 )  )    )+2209190400)/24/60/60\n    #### use interval type, this is the best\n    start.ee<-  min(which(dat[,2]>0))-1\n    if (start.ee>1)\n    {\n      ee.new.int.type <-c( ee.new[1:((start.ee)-1)],ee.new[start.ee]+(dat$DataCount[start.ee:nrow(dat)]/10/24/60/60)  )\n    }else\n    {    ee.new.int.type <-ee.new[start.ee]+(dat$DataCount[start.ee:nrow(dat)]/10/24/60/60)\n    } #### if interval type has large difference with character type, use character type\n    int.dif.char<-which(abs(ee.new-ee.new.int.type)>0.1 )\n    ee.new.int.type[int.dif.char]<-ee.new[int.dif.char]\n    ####\n    dat<-cbind(ee.new.int.type,dat[,2:6])\n  }\n  final.dat<-dat[,c(1,3,4,6)]\n  colnames(final.dat)<-c(\"date.time\",\"Interval\",\"ActivityCode\", \"METs\")\n  final.dat=subset(final.dat,date.time!=0.625) #delete rows with time as #1899-12-30 00:00:00#\n\n  temp.mat=final.dat\n  ###################################################\n  #time.char<-as.POSIXlt(record.getup.time[ll]*24*60*60, origin = ISOdatetime(1899,12,30,0,0,0))\n  hour.char<-as.numeric(format(as.POSIXlt(temp.mat$date.time*24*60*60, origin = ISOdatetime(1899,12,30,0,0,0)),\"%H\"))\n  ###\n  temp.sed<-subset(temp.mat,temp.mat$ActivityCode==0)$Interval\n  length.temp.sed<-length(temp.sed)\n#   month<-as.numeric(format(time.char,\"%m\"))\n#   day<-as.numeric(format(time.char,\"%d\"))\n#   year<-as.numeric(format(time.char,\"%Y\"))\n  hours.worn.total<- sum(temp.mat$Interval)/60/60\n  #hours.awake<- (record.sleep.time[ll]-record.getup.time[ll])*24\n  sed.hour<- sum(temp.sed) /60/60\n  stand.hour<- sum(subset(temp.mat,temp.mat$ActivityCode==1)$Interval) /60/60\n  step.hour<- sum(subset(temp.mat,temp.mat$ActivityCode==2)$Interval) /60/60\n  num.changes.from.sed.to.non.sed<- length.temp.sed\n  ######## Code update here !\n  step.count.total<- 2*nrow(subset(temp.mat,temp.mat$ActivityCode==2))  ##### in the event file, one row with ActivityCode==2 means two steps\n  ########\n  gini.index<- gini(temp.sed)\n  num.hour.over.3.METs<-  sum(temp.mat$Interval[(temp.mat$METs/temp.mat$Interval)*60*60>3])/60/60\n  MET.hours<- sum(temp.mat$METs)\n  #valid.day<-ifelse( (hours.worn.total<10 & hours.worn.total/hours.awake>0.8 & step.count.total>200) | (hours.worn.total>=10 & step.count.total>200 ),1,0    )\n  #dayofweek<-as.numeric(format(time.char,\"%w\"))\n  #weekday.or.weekend<- ifelse( dayofweek!=0 & dayofweek!=6,1,0)\n  #table1<-c(person,group.char,www,month,day,year,hours.worn.total,hours.awake,sed.hour,stand.hour,step.hour,num.changes.from.sed.to.non.sed,step.count.total,gini.index,num.hour.over.3.METs,MET.hours,valid.day,dayofweek,weekday.or.weekend)\n  table<-cbind(hours.worn.total,sed.hour,stand.hour,step.hour,num.changes.from.sed.to.non.sed,step.count.total,gini.index,num.hour.over.3.METs,MET.hours)\n  colnames(table)<-c(\"hours.worn.total\",\"sed.hour\",\"stand.hour\",\"step.hour\",\"num.changes.from.sed.to.non.sed\",\"step.count.total\",\"gini.index\",\"num.hour.over.3.METs\",\"MET.hours\")\n\n  out=list(  temp.mat= temp.mat,temp.sed= temp.sed,length.temp.sed=length.temp.sed,hour.char=hour.char, step.count.total= step.count.total,hours.worn.total=hours.worn.total, sed.hour=sed.hour, stand.hour=stand.hour, step.hour=step.hour, num.changes.from.sed.to.non.sed=num.changes.from.sed.to.non.sed, gini.index=gini.index,num.hour.over.3.METs=num.hour.over.3.METs,MET.hours=MET.hours,table=table)\n\n #table1.label<-c(\"id\",\"group\",\"week\",\"month\",\"day\",\"year\",\"hours.worn.total\",\"hours.awake\",\"sed.hour\",\"stand.hour\",\"step.hour\",\"num.changes.from.sed.to.non.sed\",\"step.count.total\",\"gini.index\",\"num.hour.over.3.METs\",\"MET.hours\",\"valid.day\",\"dayofweek\",\"weekday.or.weekend\")\n  #num.hour.over.3.METs=num.hour.over.3.METs\n  return(out)\n}\n",
    "created" : 1450303807646.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2160915500",
    "id" : "4E293E6E",
    "lastKnownWriteTime" : 1450303824,
    "path" : "~/wear/R/PA_summary.R",
    "project_path" : "R/PA_summary.R",
    "properties" : {
    },
    "relative_order" : 11,
    "source_on_save" : false,
    "type" : "r_source"
}