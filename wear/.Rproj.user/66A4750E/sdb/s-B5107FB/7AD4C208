{
    "contents" : "#' Physical Activity Summary\n#'\n#' Summarize activity measures\n#' @param final.dat cleaned final data that is between record getup time and sleep time\n#' @param record.sleep.time Log file of sleep time\n#' @param record.getup.time Log file of getup time\n#' @param ll the id of getup time record\n#' @return hours.worn.total Total worn hours\n#' @return hours.awake    Total awake hours\n#' @return sed.hour  Total sedantary hours\n#' @return ... ...\n#' @export\nPA_summary=function (final.dat,record.sleep.time,record.getup.time,person,www) {\n  Summary.Statistics.Table1<-c()\n  for (ll in 1: length(record.getup.time) )\n  {\n    ## ll=1\n    temp.mat<-subset(final.dat,final.dat[,1]>record.getup.time[ll] & final.dat[,1]<record.sleep.time[ll] )\n    if(nrow(temp.mat)==0)next\n\n  ###################################################\n  time.char<-as.POSIXlt(record.getup.time[ll]*24*60*60, origin = ISOdatetime(1899,12,30,0,0,0))\n  hour.char<-as.numeric(format(as.POSIXlt(temp.mat$date.time*24*60*60, origin = ISOdatetime(1899,12,30,0,0,0)),\"%H\"))\n  ###\n\n  temp.sed<-subset(temp.mat,temp.mat$ActivityCode==0)$Interval\n  length.temp.sed<-length(temp.sed)\n  ####group\n  group.char<- as.character(subset(import.APST.csvfile.groups,id==person)$group)\n  if (length(group.char)==0) group.char<- NA\n  time.char<-as.POSIXlt(record.getup.time[ll]*24*60*60, origin = ISOdatetime(1899,12,30,0,0,0))\n  month<-as.numeric(format(time.char,\"%m\"))\n  day<-as.numeric(format(time.char,\"%d\"))\n  year<-as.numeric(format(time.char,\"%Y\"))\n  hours.worn.total<- sum(temp.mat$Interval)/60/60\n  hours.awake<- (record.sleep.time[ll]-record.getup.time[ll])*24\n  sed.hour<- sum(temp.sed) /60/60\n  stand.hour<- sum(subset(temp.mat,temp.mat$ActivityCode==1)$Interval) /60/60\n  step.hour<- sum(subset(temp.mat,temp.mat$ActivityCode==2)$Interval) /60/60\n  num.changes.from.sed.to.non.sed<- length.temp.sed\n  ######## Code update here !\n  step.count.total<- 2*nrow(subset(temp.mat,temp.mat$ActivityCode==2))  ##### in the event file, one row with ActivityCode==2 means two steps\n  ########\n  gini.index<- gini(temp.sed)\n num.hour.over.3.METs<-  sum(temp.mat$Interval[(temp.mat$METs/temp.mat$Interval)*60*60>3])/60/60\n  MET.hours<- sum(temp.mat$METs)\n  valid.day<-ifelse( (hours.worn.total<10 & hours.worn.total/hours.awake>0.8 & step.count.total>200) | (hours.worn.total>=10 & step.count.total>200 ),1,0    )\n  dayofweek<-as.numeric(format(time.char,\"%w\"))\n  weekday.or.weekend<- ifelse( dayofweek!=0 & dayofweek!=6,1,0)\n  #table1<-c(person,group.char,www,month,day,year,hours.worn.total,hours.awake,sed.hour,stand.hour,step.hour,num.changes.from.sed.to.non.sed,step.count.total,gini.index,num.hour.over.3.METs,MET.hours,valid.day,dayofweek,weekday.or.weekend)\n  table1<-c(person,group.char,www,month,day,year,hours.worn.total,hours.awake,sed.hour,stand.hour,step.hour,num.changes.from.sed.to.non.sed,step.count.total,gini.index,num.hour.over.3.METs,MET.hours,valid.day,dayofweek,weekday.or.weekend)\n table1.label<-c(\"id\",\"group\",\"week\",\"month\",\"day\",\"year\",\"hours.worn.total\",\"hours.awake\",\"sed.hour\",\"stand.hour\",\"step.hour\",\"num.changes.from.sed.to.non.sed\",\"step.count.total\",\"gini.index\",\"num.hour.over.3.METs\",\"MET.hours\",\"valid.day\",\"dayofweek\",\"weekday.or.weekend\")\n Summary.Statistics.Table1<-rbind(Summary.Statistics.Table1,table1)\n#   out=list(  temp.mat= temp.mat,temp.sed= temp.sed,length.temp.sed=length.temp.sed,hour.char=hour.char, step.count.total= step.count.total,month = month, day = day,year=year,hours.worn.total=hours.worn.total, hours.awake=hours.awake, sed.hour=sed.hour, stand.hour=stand.hour, step.hour=step.hour, num.changes.from.sed.to.non.sed=num.changes.from.sed.to.non.sed, gini.index=gini.index,num.hour.over.3.METs=num.hour.over.3.METs,MET.hours=MET.hours,valid.day=valid.day,dayofweek=dayofweek,weekday.or.weekend=weekday.or.weekend,table1=table1,table1.label=table1.label,Summary.Statistics.Table1=Summary.Statistics.Table1)\n  #table1.label<-c(\"id\",\"group\",\"week\",\"month\",\"day\",\"year\",\"hours.worn.total\",\"hours.awake\",\"sed.hour\",\"stand.hour\",\"step.hour\",\"num.changes.from.sed.to.non.sed\",\"step.count.total\",\"gini.index\",\"num.hour.over.3.METs\",\"MET.hours\",\"valid.day\",\"dayofweek\",\"weekday.or.weekend\")\n #num.hour.over.3.METs=num.hour.over.3.METs,\n\n  }\n  colnames(Summary.Statistics.Table1)=c(\"id\",\"group\",\"week\",\"month\",\"day\",\"year\",\"hours.worn.total\",\"hours.awake\",\"sed.hour\",\"stand.hour\",\"step.hour\",\"num.changes.from.sed.to.non.sed\",\"step.count.total\",\"gini.index\",\"num.hour.over.3.METs\",\"MET.hours\",\"valid.day\",\"dayofweek\",\"weekday.or.weekend\")\n\n  out=list(Summary.Statistics.Table1=Summary.Statistics.Table1,table1.label=table1.label)\n\n  return(out)\n}\n",
    "created" : 1449191865493.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "966802507",
    "id" : "7AD4C208",
    "lastKnownWriteTime" : 1449270346,
    "path" : "~/wear/R/PA_summary.R",
    "project_path" : "R/PA_summary.R",
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "type" : "r_source"
}