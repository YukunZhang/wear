{
    "contents" : "#' Standing/light intensity Summary\n#'\n#' Summarize Standing and light intensity activity measures\n#' @param final_dat cleaned final data that is between record getup time and sleep time\n\n#' @return \\code{total_number_of_activity_bouts} Total events that are standing or stepping\n#' @return \\code{mean_activity_bout_length} Average length of activity bout\n#' @return \\code{prop_of_activity_time_greater_5min} The ratio of the number of active bouts greater than 5 min to the total number of active events\n#' @return \\code{prop_of_activity_time_greater_10min} The ratio of the number of active bouts greater than 10 min to the total number of active events.\n#' @return \\code{prop_of_activity_time_greater_30min} The ratio of the number of active bouts greater than 30 min to the total number of active events.\n#' @return \\code{total_activity_time_greater_5min} The summation of the active durations which are greater than 5 min\n#' @return \\code{total_activity_time_greater_10min} The summation of the active durations which are greater than 10 min\n#' @return \\code{total_activity_time_greater_30min} The summation of the active durations which are greater than 30 min\n#' @return \\code{percentile_activity_time_5} 5\\% percentile of activity bouth length\n#' @return \\code{percentile_activity_time_25} 25\\% percentile of activity bout length\n#' @return \\code{percentile_activity_time_50} 50\\% percentile of activity bout length\n#' @return \\code{percentile_activity_time_75} 75\\% percentile of activity bout length\n#' @return \\code{percentile_activity_time_95} 95\\% percentile of activity bout length\n#' @return \\code{alpha_activity} alpha of activity time, see details\n#' @return \\code{stepping_to_standing_ratio} Ratio of stepping to standing, the ratio of total stepping hours to standing hours\n#' @return \\code{table} A table that combine all outputs\n#' @details  \\code{alpha_activity} is defined by \\code{1+1/M}, where \\code{M} is the average of \\code{log(activity bout length /minimum activity bout length)}\n\n#' @examples  data(sample_event);data(sample_bed_time);data(sample_takeon_time);SLI_summary(sample_event,sample_takeon_log,sample_bed_time)\n#' @importFrom stats quantile\n#' @export\n#'\n\nSLI_summary=function(final_dat,takeoff.time,bed.time){\n  #library(reldist)\n  final_dat=clean_time(final_dat,takeoff.time)\n  table1=c()\n  record.getup<-bed.time\n  ###\n  record.getup.time<-c()\n  record.sleep.time<-c()\n  for (kk in 1:nrow(record.getup))\n  {\n    temp.getup.time<-as.numeric(as.POSIXlt(strptime(as.character(paste(as.character(record.getup[kk,3] ),as.character(record.getup[kk,4]))),\"%m/%d/%Y %H:%M:%S\"))+2209136400)/24/60/60\n    record.getup.time<-c(record.getup.time,temp.getup.time)\n    temp.sleep.time<-as.numeric(as.POSIXlt(strptime(as.character(paste(as.character(record.getup[kk,5] ),as.character(record.getup[kk,6]))),\"%m/%d/%Y %H:%M:%S\"))+2209136400)/24/60/60\n    record.sleep.time<-c(record.sleep.time,temp.sleep.time)\n  }\n\n  temp_mat_for_activity<- final_dat\n  temp_mat_for_activity$Activity[temp_mat_for_activity$Activity==1]<-2\n  end_pos<-cumsum(rle(temp_mat_for_activity$Activity)$lengths)\n  start_pos<-c(0,end_pos[1:(length(end_pos)-1)])+1\n  ############### for each runs, handle the data\n  handle_runs<- sapply(1:length(end_pos),function(x,data_mat=temp_mat_for_activity)\n  {\n    select_data<-data_mat[start_pos[x]:end_pos[x],]\n    combine_data<- c(min(select_data$date_time),sum(select_data$Interval),max(select_data$Activity),sum(select_data$METs),min(select_data$new_date) )\n    return(combine_data)\n  }, simplify=F\n  )\n  ############### combine each run\n  combined_temp_mat_for_activity<-data.frame(do.call(rbind,handle_runs))\n  colnames(combined_temp_mat_for_activity)<-c(\"date_time\", \"Interval\", \"ActivityCode\",\"METs\",\"new_date\")\n  ###############\n  table1=c()\n  ###################################################\n  ll=0 #count for getup time\n\n  for (i in unique(combined_temp_mat_for_activity$new_date)){\n    ll=ll+1\n    temp_mat_oneday=final_dat[final_dat$new_date==i,]\n  temp_mat_oneday<-temp_mat_oneday[temp_mat_oneday[,1]>record.getup.time[ll] &temp_mat_oneday[,1]<record.sleep.time[ll], ]\n\n    final_dat_oneday=combined_temp_mat_for_activity[combined_temp_mat_for_activity$new_date==i,]\n    final_dat_oneday<-final_dat_oneday[final_dat_oneday[,1]>record.getup.time[ll] &final_dat_oneday[,1]<record.sleep.time[ll], ]\n\n    time_char<-as.POSIXlt(i*24*60*60, origin = ISOdatetime(1899,12,30,0,0,0))\n    month<-as.numeric(format(time_char,\"%m\"))\n    day<-as.numeric(format(time_char,\"%d\"))\n    year<-as.numeric(format(time_char,\"%Y\"))\n\n\n\n  ###############Calculation\n  ###############\n  ###\n  temp_activity<-subset(final_dat_oneday,final_dat_oneday$ActivityCode==2)$Interval\n  ###\n  length_temp_activity<-length(temp_activity)\n  total_number_of_activity_bouts<- length_temp_activity\n  mean_activity_bout_length<- mean(temp_activity) /60/60\n\n  prop_of_activity_time_greater_5min<- 100*length(temp_activity[temp_activity>5*60])/length_temp_activity\n  prop_of_activity_time_greater_10min<- 100*length(temp_activity[temp_activity>10*60])/length_temp_activity\n  prop_of_activity_time_greater_30min<- 100*length(temp_activity[temp_activity>30*60])/length_temp_activity\n\n  total_activity_time_greater_5min<- sum(temp_activity[temp_activity>5*60])/60/60\n  total_activity_time_greater_10min<- sum(temp_activity[temp_activity>10*60])/60/60\n  total_activity_time_greater_30min<- sum(temp_activity[temp_activity>30*60])/60/60\n\n  quantile_activity_temp<-quantile(temp_activity, probs = c(0.05,0.25,0.5,0.75,0.95))/60/60\n  percentile_activity_time_5<- quantile_activity_temp[1]\n  percentile_activity_time_25<- quantile_activity_temp[2]\n  percentile_activity_time_50<- quantile_activity_temp[3]\n  percentile_activity_time_75<- quantile_activity_temp[4]\n  percentile_activity_time_95<- quantile_activity_temp[5]\n\n  alpha_activity<- 1+ 1/mean(log(temp_activity/ min(temp_activity)))\n  #gini_index_activity<- gini(temp_activity)\n  step_hour<- sum(subset(temp_mat_oneday,temp_mat_oneday$ActivityCode==2)$Interval) /60/60\n  stand_hour<- sum(subset(temp_mat_oneday,temp_mat_oneday$ActivityCode==1)$Interval) /60/60\n\n  stepping_to_standing_ratio<- step_hour/stand_hour\n\n  table<- cbind(year,month,day,total_number_of_activity_bouts,mean_activity_bout_length,prop_of_activity_time_greater_5min,prop_of_activity_time_greater_10min,prop_of_activity_time_greater_30min,total_activity_time_greater_5min,total_activity_time_greater_10min,total_activity_time_greater_30min,percentile_activity_time_5,percentile_activity_time_25,percentile_activity_time_50,percentile_activity_time_75,percentile_activity_time_95,alpha_activity,stepping_to_standing_ratio)\n  row.names(table)=NULL\n  table1=rbind(table1,table)\n  #print(table1)\n\n  }\n  colnames(table1)<- c(\"year\",\"month\",\"day\",\"total_number_of_activity_bouts\",\"mean_activity_bout_length\",\"prop_of_activity_time_greater_5min\",\"prop_of_activity_time_greater_10min\",\"prop_of_activity_time_greater_30min\",\"total_activity_time_greater_5min\",\"total_activity_time_greater_10min\",\"total_activity_time_greater_30min\",\"percentile_activity_time_5\",\"percentile_activity_time_25\",\"percentile_activity_time_50\",\"percentile_activity_time_75\",\"percentile_activity_time_95\",\"alpha_activity\",\"stepping_to_standing_ratio\")\n\n  #out=list( total_number_of_activity_bouts=total_number_of_activity_bouts,mean_activity_bout_length=mean_activity_bout_length,prop_of_activity_time_greater_5min=prop_of_activity_time_greater_5min,prop_of_activity_time_greater_10min=prop_of_activity_time_greater_10min,prop_of_activity_time_greater_30min=prop_of_activity_time_greater_30min,total_activity_time_greater_5min=total_activity_time_greater_5min,total_activity_time_greater_10min=total_activity_time_greater_10min,total_activity_time_greater_30min=total_activity_time_greater_30min,percentile_activity_time_5=percentile_activity_time_5,percentile_activity_time_25=percentile_activity_time_25,percentile_activity_time_50=percentile_activity_time_50,percentile_activity_time_75=percentile_activity_time_75,percentile_activity_time_95=percentile_activity_time_95,alpha_activity=alpha_activity,stepping_to_standing_ratio=stepping_to_standing_ratio,table=table)\n  return(table1)\n}\n",
    "created" : 1454369980294.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2200461416",
    "id" : "6FEAB8E8",
    "lastKnownWriteTime" : 1454475709,
    "path" : "C:/Users/Yukun Zhang/Desktop/Yukun/wear/R/SLI_summary.R",
    "project_path" : "R/SLI_summary.R",
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "type" : "r_source"
}